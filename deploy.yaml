- name: Deploy
  hosts: [localhost]
  gather_facts: false
  vars:
    application: finalproject
    instance_ids:
      - 'i-00b6c5849dcc3e4a7'
  tasks:
    - lineinfile:
        path: /etc/sudoers
        state: present
        regexp: '^%sudo'
        line: '%sudo ALL=(ALL) NOPASSWD: ALL'
        validate: 'visudo -cf %s'
    - name: Check Minikube's status.
      command: minikube status
      register: minikube_status
      changed_when: false
      ignore_errors: true
    # Otherwise will start minikube
    - name: Start Minikube if it's not running.
      command: minikube start --driver=none
      become: true
      when: "not minikube_status.stdout or 'Running' not in minikube_status.stdout"
    - name: init minikube
      include_role: 
        name: check_minikube